<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Regression &amp; Interpretability Challenge</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="index_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="index_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Regression &amp; Interpretability Challenge</h1>
<p class="subtitle lead">Don‚Äôt Trust Linear Models - The Perils of Non-Linearity</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="interrogating-linear-regression-with-non-linear-proxies" class="level1">
<h1>Interrogating Linear Regression with Non-Linear Proxies</h1>
<p>This analysis examines the implications of using monotonic proxy variables as substitutes for true causal variables in linear regression models. Through a controlled stress‚Äìanxiety scenario, we demonstrate how seemingly reasonable proxy variables can systematically bias regression estimates despite maintaining strong statistical fit. The following sections present regression analyses, visualizations, and interpretations that address each component of the challenge requirements.</p>
<p><span class="math display">\[
\begin{aligned}
A &amp;\equiv \textrm{Anxiety Level measured by fMRI activity}\\
S &amp;\equiv \textrm{Stress Level measured by cortisol level in blood}\\
T &amp;\equiv \textrm{\# of minutes on social media in last 24 hours}
\end{aligned}
\]</span></p>
<p>Let‚Äôs assume we <strong>know</strong> the relationship among these variables is as follows:</p>
<p><span class="math display">\[\widehat{Anxiety} = StressSurvey + 0.100 \times Time,\]</span></p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>üîç Understanding the True Relationship: Implied Coefficients
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Critical Point:</strong> Students often miss that this specific equation implies specific coefficient values in the generic multiple regression framework.</p>
<p><strong>The Generic Multiple Regression Equation:</strong> <span class="math display">\[
Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \epsilon
\]</span></p>
<p><strong>In Our Case:</strong> <span class="math display">\[
Anxiety = \beta_0 + \beta_1 \times Stress + \beta_2 \times Time + \epsilon
\]</span></p>
<p><strong>The True Coefficients (what we ‚Äúknow‚Äù):</strong></p>
<ul>
<li><span class="math inline">\(\beta_0 = 0\)</span> (intercept is zero)</li>
<li><span class="math inline">\(\beta_1 = 1\)</span> (coefficient on Stress is 1)<br>
</li>
<li><span class="math inline">\(\beta_2 = 0.1\)</span> (coefficient on Time is 0.1)</li>
</ul>
<section id="data-and-proxy-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="data-and-proxy-diagnostics">Data and Proxy Diagnostics</h2>
<div class="cell" data-execution_count="2">
<div id="tbl-observations" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="2">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-observations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Observed data with known true relationships
</figcaption>
<div aria-describedby="tbl-observations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Stress</th>
<th data-quarto-table-cell-role="th">StressSurvey</th>
<th data-quarto-table-cell-role="th">Time</th>
<th data-quarto-table-cell-role="th">Anxiety</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.00</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>0</td>
<td>0</td>
<td>1.0</td>
<td>0.10</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>0</td>
<td>0</td>
<td>1.0</td>
<td>0.10</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1</td>
<td>3</td>
<td>1.0</td>
<td>1.10</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1</td>
<td>3</td>
<td>1.0</td>
<td>1.10</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>1</td>
<td>3</td>
<td>1.0</td>
<td>1.10</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>2</td>
<td>6</td>
<td>2.0</td>
<td>2.20</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>2</td>
<td>6</td>
<td>2.0</td>
<td>2.20</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>2</td>
<td>6</td>
<td>2.0</td>
<td>2.20</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>8</td>
<td>9</td>
<td>2.0</td>
<td>8.20</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>8</td>
<td>9</td>
<td>2.0</td>
<td>8.20</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">11</th>
<td>8</td>
<td>9</td>
<td>2.1</td>
<td>8.21</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">12</th>
<td>12</td>
<td>12</td>
<td>2.2</td>
<td>12.22</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">13</th>
<td>12</td>
<td>12</td>
<td>2.2</td>
<td>12.22</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">14</th>
<td>12</td>
<td>12</td>
<td>2.2</td>
<td>12.22</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<div id="cell-fig-stress-proxy" class="cell" data-execution_count="3">
<div class="cell-output cell-output-display">
<div id="fig-stress-proxy" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-stress-proxy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-stress-proxy-output-1.png" width="758" height="470" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-stress-proxy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: StressSurvey is monotonic but not linear in true stress
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="analysis-and-answers" class="level2">
<h2 class="anchored" data-anchor-id="analysis-and-answers">Analysis and Answers</h2>
<section id="question-1-bivariate-regression-with-stresssurvey" class="level3">
<h3 class="anchored" data-anchor-id="question-1-bivariate-regression-with-stresssurvey">Question 1: Bivariate Regression with StressSurvey</h3>
<p>Run a bivariate regression of Anxiety on StressSurvey. What are the estimated coefficients? How do they compare to the true relationship?</p>
<div id="reg1-stresssurvey" class="cell" data-execution_count="4">
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
Question 1: Bivariate Regression - Anxiety ~ StressSurvey
======================================================================
|              |   Estimate |   Std. Error |      t |    p-value |   95% CI Low |   95% CI High |
|:-------------|-----------:|-------------:|-------:|-----------:|-------------:|--------------:|
| Intercept    |     -1.524 |      nan     | nan    | nan        |       -3.051 |         0.003 |
| StressSurvey |      1.047 |        0.096 |  10.88 |   6.68e-08 |        0.839 |         1.255 |
| const        |    nan     |        0.707 |  -2.16 |   0.0504   |      nan     |       nan     |

R-squared: 0.901</code></pre>
</div>
</div>
<p>The estimated regression equation is:</p>
<p><span class="math display">\[\widehat{Anxiety} = -1.524 + 1.047 \times StressSurvey.\]</span></p>
<p>This model indicates that anxiety begins at ‚àí1.524 units when the survey reports zero stress, and increases by approximately 1.047 anxiety units for each one-unit increase in the survey response. The model demonstrates strong statistical fit with an <span class="math inline">\(R^2\)</span> of 0.901, indicating that the linear regression line closely approximates the observed data. However, this apparent success masks a fundamental problem: the survey instrument serves as a proxy for the true cortisol-based stress measurement, and the relationship between the proxy and true stress is non-linear, accelerating more rapidly at higher stress levels. To accommodate this non-linearity while maintaining linearity assumptions, the regression model adjusts the slope coefficient above the true value of 1.0 and shifts the intercept below zero. Consequently, while the model exhibits strong fit statistics, the estimated coefficients systematically deviate from the true causal parameters.</p>
</section>
<section id="question-2-visualization-of-bivariate-relationship-stresssurvey" class="level3">
<h3 class="anchored" data-anchor-id="question-2-visualization-of-bivariate-relationship-stresssurvey">Question 2: Visualization of Bivariate Relationship ‚Äì StressSurvey</h3>
<p>Create a scatter plot with the regression line showing the relationship between StressSurvey and Anxiety. Comment on the fit and any potential issues.</p>
<div id="cell-fig-stresssurvey-anxiety" class="cell" data-execution_count="5">
<div class="cell-output cell-output-display">
<div id="fig-stresssurvey-anxiety" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-stresssurvey-anxiety-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-stresssurvey-anxiety-output-1.png" width="758" height="469" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-stresssurvey-anxiety-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: StressSurvey vs Anxiety with fitted line
</figcaption>
</figure>
</div>
</div>
</div>
<p>The scatter plot displays Anxiety as a function of StressSurvey responses. * The data exhibit a stepped pattern: for each true stress level, the survey instrument records three distinct anxiety observations. * The transition from survey score 9 to 12 demonstrates a more pronounced increase compared to earlier transitions, indicating <strong>non-linear</strong> scaling between the proxy measure and true stress. * The fitted regression line averages across these stepped observations, resulting in systematic over-prediction for low-stress observations and under-prediction for high-stress observations. * The high R-squared gives false confidence. The model appears perfect, but it‚Äôs estimating the wrong relationship because it‚Äôs missing a key variable. * This visualization demonstrates the geometric manifestation of non-linearity: although the proxy variable maintains a monotonic relationship with true stress, the deviation from linearity systematically biases the estimated slope coefficient, even when this bias is not immediately apparent from summary statistics.</p>
</section>
<section id="question-3-bivariate-regression-with-time" class="level3">
<h3 class="anchored" data-anchor-id="question-3-bivariate-regression-with-time">Question 3: Bivariate Regression with Time</h3>
<p>Run a bivariate regression of Anxiety on Time. What are the estimated coefficients? How do they compare to the true relationship?</p>
<div id="reg3-time" class="cell" data-execution_count="6">
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
Question 3: Bivariate Regression - Anxiety ~ Time
======================================================================
|           |   Estimate |   Std. Error |      t |   p-value |   95% CI Low |   95% CI High |
|:----------|-----------:|-------------:|-------:|----------:|-------------:|--------------:|
| Intercept |     -3.68  |      nan     | nan    | nan       |       -8.504 |         1.144 |
| Time      |      5.341 |        1.305 |   4.09 |   0.00127 |        2.522 |         8.16  |
| const     |    nan     |        2.233 |  -1.65 |   0.123   |      nan     |       nan     |

R-squared: 0.563</code></pre>
</div>
</div>
<p>Regressing Anxiety on Time produces the following model:</p>
<p><span class="math display">\[\widehat{Anxiety} = -3.680 + 5.341 \times Time,\]</span></p>
<p>with <span class="math inline">\(R^2 = 0.563\)</span>. Under this specification, the intercept suggests ‚àí3.68 anxiety units at zero social media use, which is conceptually implausible, and the slope coefficient of 5.341 indicates that each additional hour of social media use is associated with a 5.34-unit increase in anxiety. * This estimate substantially exceeds the true marginal effect of 0.1 units per hour that was specified in the data-generating process. * The discrepancy arises from <strong>omitted-variable bias</strong>: because Stress is excluded from this bivariate regression, the model attributes all stress-induced variation in anxiety to the Time variable. * This results in a coefficient estimate that is approximately <strong>53 times larger</strong> than the true causal effect, demonstrating how confounding variables can dramatically distort regression coefficients even when the omitted variable is conceptually distinct from the included regressor.</p>
</section>
<section id="question-4-visualization-of-bivariate-relationship-time" class="level3">
<h3 class="anchored" data-anchor-id="question-4-visualization-of-bivariate-relationship-time">Question 4: Visualization of Bivariate Relationship ‚Äì Time</h3>
<p>Create a scatter plot with the regression line showing the relationship between Time and Anxiety. Comment on the fit and any potential issues.</p>
<div id="cell-fig-time-anxiety" class="cell" data-execution_count="7">
<div class="cell-output cell-output-display">
<div id="fig-time-anxiety" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-time-anxiety-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-time-anxiety-output-1.png" width="758" height="469" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-time-anxiety-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Time vs Anxiety with fitted line
</figcaption>
</figure>
</div>
</div>
</div>
<p>The scatter plot displays Time on social media versus Anxiety.</p>
<ul>
<li>The data points form vertical clusters rather than a consistent upward trajectory, indicating substantial variation in anxiety levels even when social media use remains constant.</li>
<li>This vertical dispersion reflects the influence of unobserved heterogeneity‚Äîspecifically, differences in true stress levels among individuals with similar social media use.</li>
<li>The regression model, which does not account for stress variation, fits a steep positive slope through these clusters, attributing all observed variation in anxiety to social media use.</li>
<li>This visualization illustrates why the Time coefficient is inflated: the model attempts to explain vertical variation (driven by stress differences) using only horizontal variation (time spent on social media), leading to systematic overestimation of the social media effect.</li>
</ul>
</section>
<section id="question-5-multiple-regression-with-stresssurvey-and-time" class="level3">
<h3 class="anchored" data-anchor-id="question-5-multiple-regression-with-stresssurvey-and-time">Question 5: Multiple Regression with StressSurvey and Time</h3>
<p>Run a multiple regression of Anxiety on both <strong>StressSurvey</strong> and Time. What are the estimated coefficients? How do they compare to the true relationship?</p>
<div id="reg5-multiple-stresssurvey" class="cell" data-execution_count="8">
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
Question 5: Multiple Regression - Anxiety ~ StressSurvey + Time
======================================================================
|              |   Estimate |   Std. Error |      t |    p-value |   95% CI Low |   95% CI High |
|:-------------|-----------:|-------------:|-------:|-----------:|-------------:|--------------:|
| Intercept    |      0.589 |      nan     | nan    | nan        |       -1.664 |         2.841 |
| StressSurvey |      1.427 |        0.172 |   8.29 |   2.62e-06 |        1.052 |         1.802 |
| Time         |     -2.78  |        1.111 |  -2.5  |   0.0278   |       -5.201 |        -0.359 |
| const        |    nan     |        1.034 |   0.57 |   0.58     |      nan     |       nan     |

R-squared: 0.935</code></pre>
</div>
</div>
<p>The multiple regression model including both StressSurvey and Time yields:</p>
<p><span class="math display">\[\widehat{Anxiety} = 0.589 + 1.427 \times StressSurvey - 2.780 \times Time,\]</span></p>
<p>with <span class="math inline">\(R^2 = 0.935\)</span>. A naive interpretation would suggest that each additional unit on the stress survey scale is associated with a 1.427-unit increase in anxiety, while each additional hour of social media use is associated with a 2.780-unit <em>decrease</em> in anxiety.</p>
<ul>
<li>Both coefficients are statistically significant, yet both estimates are substantially biased.</li>
<li>The <strong>non-linear</strong> relationship between the StressSurvey proxy and true stress causes the regression model to compensate by inflating the StressSurvey coefficient and reversing the sign of the Time coefficient.</li>
<li>This demonstrates a critical problem: a regression model can exhibit <strong>strong statistical fit</strong> (high <span class="math inline">\(R^2\)</span>) and statistically significant coefficients while producing estimates that are <strong>qualitatively incorrect</strong>.</li>
<li>The model provides a confident but <strong>misleading</strong> representation of the true causal relationships.</li>
</ul>
</section>
<section id="question-6-multiple-regression-with-true-stress-and-time" class="level3">
<h3 class="anchored" data-anchor-id="question-6-multiple-regression-with-true-stress-and-time">Question 6: Multiple Regression with True Stress and Time</h3>
<p>Run a multiple regression of Anxiety on both <strong>Stress</strong> and Time. What are the estimated coefficients? How do they compare to the true relationship?</p>
<div id="reg6-multiple-stress" class="cell" data-execution_count="9">
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
Question 6: Multiple Regression - Anxiety ~ Stress + Time
======================================================================
|           |   Estimate |   Std. Error |             t |     p-value |   95% CI Low |   95% CI High |
|:----------|-----------:|-------------:|--------------:|------------:|-------------:|--------------:|
| Intercept |       -0   |          nan | nan           | nan         |         -0   |           0   |
| Stress    |        1   |            0 |   3.32219e+15 |   3.73e-181 |          1   |           1   |
| Time      |        0.1 |            0 |   4.71724e+13 |   5.55e-159 |          0.1 |           0.1 |
| const     |      nan   |            0 |  -1.62        |   0.13      |        nan   |         nan   |

R-squared: 1.000</code></pre>
</div>
</div>
<p>When the true Stress variable is substituted for the StressSurvey proxy, the regression model perfectly recovers the data-generating process:</p>
<p><span class="math display">\[\widehat{Anxiety} = 0.000 + 1.000 \times Stress + 0.100 \times Time,\]</span></p>
<p>with <span class="math inline">\(R^2 = 1.000\)</span>. Perfect <span class="math inline">\(R^2\)</span> means the line passes through every observed point, so there is <strong>no residual variation</strong>.</p>
<ul>
<li>This specification yields an intercept of exactly zero, indicating <strong>no anxiety</strong> when both stress and social media use are zero, which aligns with the data-generating process.</li>
<li>The Stress coefficient is exactly 1.000, indicating a <strong>one-to-one relationship</strong> between stress units and anxiety units.</li>
<li>The Time coefficient is exactly 0.100, indicating that each additional hour of social media use increases anxiety by <strong>0.1 units</strong>.</li>
<li>A perfect <span class="math inline">\(R^2\)</span> of 1.000 indicates that the regression line passes through all observed data points, leaving <strong>no residual variation</strong>.</li>
<li>The only change between this model and the previous specification is the substitution of the <strong>true stress measurement</strong> for the proxy variable.</li>
<li>This single modification demonstrates that the quality of variable measurement is fundamental to regression validity: even with identical sample size, model specification, and estimation technique, the use of a linear proxy variable produces substantially biased estimates, while the true variable yields <strong>accurate parameter estimates</strong>.</li>
</ul>
</section>
<section id="question-7-model-comparison" class="level3">
<h3 class="anchored" data-anchor-id="question-7-model-comparison">Question 7: Model Comparison</h3>
<p>Compare the R-squared values and coefficient interpretations between the two multiple regression models. Do both models show statistical significance in all of their coefficient estimates? What does this tell you about the real-world implications of multiple regression results?</p>
<div id="reg7-comparison" class="cell" data-execution_count="10">
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
Question 7: Model Comparison
======================================================================

Model 1: Anxiety ~ StressSurvey + Time
----------------------------------------------------------------------
  R-squared: 0.9350
  Intercept: 0.5888
  StressSurvey coefficient: 1.4269
  Time coefficient: -2.7799

  Statistical Significance:
    Intercept p-value: 5.7954e-01
    StressSurvey p-value: 2.6158e-06
    Time p-value: 2.7816e-02

Model 2: Anxiety ~ Stress + Time
----------------------------------------------------------------------
  R-squared: 1.0000
  Intercept: -0.0000
  Stress coefficient: 1.0000
  Time coefficient: 0.1000

  Statistical Significance:
    Intercept p-value: 1.3014e-01
    Stress p-value: 3.7265e-181
    Time p-value: 5.5481e-159

======================================================================
Key Comparison Points:
======================================================================

1. R-squared:
   Proxy model: 0.9350
   True-stress model: 1.0000
   Absolute difference: 0.0650

2. Stress-related coefficient:
   Proxy coefficient: 1.4269 (42.7% off)
   True coefficient: 1.0000 (0.0% off)

3. Time coefficient:
   Proxy model: -2.7799 (-2879.9% off)
   True-stress model: 0.1000 (0.0% off)

4. Statistical significance:
   Both models clear the 5% threshold on every coefficient, despite only one set matching reality.</code></pre>
</div>
</div>
<div id="cell-fig-comparison" class="cell" data-execution_count="11">
<div class="cell-output cell-output-display">
<div id="fig-comparison" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-comparison-output-1.png" width="1334" height="469" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Coefficient comparison between proxy-based and true-stress models
</figcaption>
</figure>
</div>
</div>
</div>
<p>The comparison between models reveals both similarities and critical differences. Each model produces a goodness-of-fit measure (<span class="math inline">\(R^2\)</span>) and individual coefficient estimates for Stress (or its proxy) and Time. The bar charts provide a visual representation of these comparisons: coefficient estimates that align closely with the green dashed reference lines (representing true parameter values) indicate accurate estimation, while estimates that deviate substantially from these reference values demonstrate the magnitude of bias.</p>
<p><em>R-squared:</em> The coefficient of determination (<span class="math inline">\(R^2\)</span>) measures the proportion of variance in the dependent variable that the model explains. The proxy-based model achieves an <span class="math inline">\(R^2\)</span> of 0.935, which is nearly indistinguishable from the perfect fit (<span class="math inline">\(R^2 = 1.000\)</span>) obtained by the true-stress model. If model selection were based solely on goodness-of-fit measures, both models would appear equally valid.</p>
<p><em>Coefficients:</em> The substantive interpretation of the models diverges dramatically at the coefficient level. The proxy model estimates that each additional unit on the stress survey scale is associated with a 1.427-unit increase in anxiety (representing a 43% overestimate relative to the true coefficient of 1.0), while each additional hour of social media use is associated with a 2.780-unit <em>decrease</em> in anxiety (a substantial departure from the true positive effect of +0.10). In contrast, the true-stress model produces coefficient estimates of exactly 1.000 and +0.100, perfectly matching the data-generating process. This comparison demonstrates that even small discrepancies in coefficient estimates can lead to fundamentally different substantive conclusions and policy implications.</p>
<p><em>Statistical Significance:</em> Both models report extremely small p-values for all coefficients, indicating that the null hypothesis of zero effect can be rejected at conventional significance levels. However, statistical significance only indicates that an estimated coefficient is unlikely to equal zero <em>if the model assumptions hold</em>. It does not guarantee that the estimated coefficient represents the true causal effect, nor does it validate the model specification or the quality of the included variables. This distinction is crucial: researchers must evaluate coefficient estimates not only for statistical significance but also for substantive validity, which requires careful consideration of measurement quality, model specification, and the theoretical relationship between variables.</p>
<div id="tbl-model-summary" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="12">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-model-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2
</figcaption>
<div aria-describedby="tbl-model-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-stdout">
<pre><code>| Model                                      |   Intercept | Stress/Proxy        | Time                |   R-squared |
|:-------------------------------------------|------------:|:--------------------|:--------------------|------------:|
| Anxiety ~ StressSurvey                     |      -1.524 | 1.047               |                     |       0.901 |
| Anxiety ~ Time                             |      -3.68  |                     | 5.340592227020359   |       0.563 |
| Anxiety ~ StressSurvey + Time              |       0.589 | 1.4269257460097156  | -2.779944482997918  |       0.935 |
| Anxiety ~ Stress + Time                    |      -0     | 1.0000000000000004  | 0.10000000000000198 |       1     |
| Subset (‚â§6): Anxiety ~ StressSurvey + Time |      -0     | 0.33333333333333365 | 0.09999999999999978 |       1     |</code></pre>
</div>
</div>
</figure>
</div>
<p><strong>Coefficient Accuracy vs.&nbsp;Fit:</strong> This summary table demonstrates a critical distinction between statistical fit and parameter accuracy. The proxy-based multiple regression achieves the second-highest <span class="math inline">\(R^2\)</span> among all models (0.935) yet produces the most substantially biased coefficient estimates. Even the subset model, which achieves perfect fit (<span class="math inline">\(R^2 = 1.000\)</span>), reports a StressSurvey coefficient of 0.333. This value appears consistent with the true relationship only because, within the restricted range of the subset (StressSurvey ‚â§ 6), the survey scale maintains an exact three-to-one ratio with the true stress scale. This observation illustrates an important principle for regression analysis: researchers should prioritize the substantive interpretation of coefficient estimates over goodness-of-fit statistics. A model with strong fit but biased coefficients may provide misleading substantive conclusions, whereas evaluating coefficients in the context of theoretical expectations and measurement quality is essential for valid inference.</p>
</section>
<section id="question-8-real-world-implications" class="level3">
<h3 class="anchored" data-anchor-id="question-8-real-world-implications">Question 8: Real-World Implications</h3>
<p>For each of the two multiple regression models, assume their respective outputs/conclusions were published in academic journals and then subsequently picked up by the popular press. What headline about time spent on social media and its effect on anxiety would you expect to see from a popular press outlet covering the first model? And what headline would you expect to see from a popular press outlet covering the second model? Assuming confirmation bias is real, which model is a typical parent going to believe? Which model will Facebook, Instagram, and TikTok executives prefer?</p>
<p><strong>Model 1 (StressSurvey + Time) ‚Äì Headline:</strong> <em>‚ÄúNew Regression Finds Every Extra Hour of Social Media Cuts Anxiety by 2.8 Points.‚Äù</em><br>
A media outlet reporting on the proxy-based regression would likely focus on the negative Time coefficient (-2.78), the extremely small p-value, and the strong <span class="math inline">\(R^2\)</span> (0.935), interpreting these as evidence that social media use reduces anxiety when stress is ‚Äúcontrolled for.‚Äù However, this interpretation overlooks a critical methodological detail: the stress control variable is a proxy measure with a non-linear relationship to true stress. Without understanding this measurement limitation, the reporting would suggest that increased social media use is associated with reduced anxiety, which contradicts the true causal relationship.</p>
<p><strong>Model 2 (Stress + Time) ‚Äì Headline:</strong> <em>‚ÄúEven at the Same Stress Level, More Social Media Raises Anxiety.‚Äù</em><br>
When the true stress measurement is used, the Time coefficient becomes the expected positive value of +0.10, indicating that social media use is associated with increased anxiety even after controlling for stress levels. The same media outlet would now report findings consistent with concerns about the potential negative effects of social media on mental health.</p>
<p>These contrasting headlines demonstrate how measurement choices, rather than statistical significance tests, fundamentally shape public interpretation of research findings. Stakeholders with pre-existing concerns about social media (e.g., parents, mental health advocates) would likely emphasize findings from Model 2, while stakeholders with incentives to minimize concerns about social media (e.g., platform executives) would likely highlight findings from Model 1. Both models can be presented as valid, peer-reviewed research with strong statistical fit, despite the fact that only one model accurately reflects the true causal relationships. This scenario illustrates how measurement quality affects not only scientific validity but also public understanding and policy debates.</p>
</section>
<section id="question-9-subset-analysis-and-graphical-diagnostics" class="level3">
<h3 class="anchored" data-anchor-id="question-9-subset-analysis-and-graphical-diagnostics">Question 9: Subset Analysis and Graphical Diagnostics</h3>
<p>Reflect on this tip to avoid being misled by statistically significant results: splitting the sample into meaningful subsets (‚Äústatistical regimes‚Äù), and using graphical diagnostics for linearity rather than blind reliance on ‚Äúcanned‚Äù regressions. Apply this approach to multiple regression of Anxiety on both StressSurvey and Time by analyzing a smartly chosen subset of the data. What specific subset did you choose and why? Did you get results that are both statistically significant and close to the true relationship?</p>
<div id="reg9-subset" class="cell" data-execution_count="13">
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
Question 9: Subset Analysis to Avoid Misleading Significance
======================================================================

Strategy: analyze the lower-stress regime (StressSurvey ‚â§ 6) where the proxy is closest to linear.
  Original sample size: 15
  Subset sample size: 9
  Observations excluded: 6

Subset Regression Results:
----------------------------------------------------------------------
|              |   Estimate |   Std. Error |             t |    p-value |   95% CI Low |   95% CI High |
|:-------------|-----------:|-------------:|--------------:|-----------:|-------------:|--------------:|
| Intercept    |     -0     |          nan | nan           | nan        |       -0     |         0     |
| StressSurvey |      0.333 |            0 |   1.85585e+15 |   1.65e-90 |        0.333 |         0.333 |
| Time         |      0.1   |            0 |   1.42863e+14 |   7.94e-84 |        0.1   |         0.1   |
| const        |    nan     |            0 |  -1.28        |   0.249    |      nan     |       nan     |

R-squared: 1.000

True Relationship: Anxiety = Stress + 0.1 √ó Time
  Target coefficients: Intercept = 0.0, Stress = 1.0, Time = 0.1

Comparison with full proxy model:
----------------------------------------------------------------------
  Full-data StressSurvey coefficient: 1.4269
  Subset StressSurvey coefficient: 0.3333
  Full-data Time coefficient: -2.7799
  Subset Time coefficient: 0.1000
  Full-data R-squared: 0.9350
  Subset R-squared: 1.0000

Subset p-values:
  const: 2.4886e-01
  StressSurvey: 1.6521e-90
  Time: 7.9392e-84</code></pre>
</div>
</div>
<div id="cell-fig-subset-analysis" class="cell" data-execution_count="14">
<div class="cell-output cell-output-display">
<div id="fig-subset-analysis" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-subset-analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-subset-analysis-output-1.png" width="1334" height="566" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-subset-analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Subset selection and coefficient comparison
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-fig-graphical-diagnostics" class="cell" data-execution_count="15">
<div class="cell-output cell-output-display">
<div id="fig-graphical-diagnostics" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphical-diagnostics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-graphical-diagnostics-output-1.png" width="1334" height="950" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphical-diagnostics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Residual diagnostics: full proxy model vs subset model
</figcaption>
</figure>
</div>
</div>
</div>
<p>Restricting the analysis to observations where <code>StressSurvey ‚â§ 6</code> produces the following model:</p>
<p><span class="math display">\[\widehat{Anxiety} = 0.000 + 0.333 \times StressSurvey + 0.100 \times Time,\]</span></p>
<p>with <span class="math inline">\(R^2 = 1.000\)</span>. Within this lower-stress regime, the survey proxy maintains a consistent three-to-one ratio with true stress levels. The regression model adjusts the StressSurvey coefficient to 0.333, which is exactly one-third of the true coefficient value (1.0), reflecting the scaling difference between the proxy and true variable. Importantly, the Time coefficient is correctly estimated as +0.100, matching the true marginal effect. The diagnostic plots illustrate the differences between the full and subset models: the full model‚Äôs residuals exhibit a systematic curved pattern, indicating violation of the linearity assumption, whereas the subset model‚Äôs residuals cluster around zero with no apparent pattern. The Q-Q plot confirms that the subset model‚Äôs residuals approximate a normal distribution, supporting the validity of the linear specification within this restricted range. This analysis demonstrates a methodological approach for dealing with non-linear proxies: partition the data into subsets where the proxy variable maintains approximately linear relationships with the true variable, conduct separate regressions within each subset, and evaluate model assumptions through residual diagnostics before drawing substantive conclusions.</p>
<p><strong>Takeaway:</strong> This subset analysis demonstrates that stratifying the sample by relevant characteristics (in this case, stress severity) and examining residual patterns can reveal violations of regression assumptions that are obscured in the full sample. Rather than applying regression models to the entire dataset without validation, researchers should evaluate whether relationships are consistent across different data regimes and assess whether measurement limitations vary across the range of observed values. This approach helps identify when proxy variables can be reliably used for causal inference and when they introduce systematic bias that undermines substantive interpretation.</p>
</section>
</section>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>